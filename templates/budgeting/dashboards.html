{% extends 'budgeting/base.html' %}
{% load humanize %}
{% block content %}
<h1>Dashboards</h1>

<h3>Recent Trend</h3>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Month</th><th>Income</th><th>Recurring</th><th>Variable</th><th>Total</th><th>Balance</th>
    </tr>
  </thead>
  <tbody>
  {% for t in trend %}
    <tr>
      <td>{{ t.month }}</td>
      <td>£{{ t.income|floatformat:2|intcomma }}</td>
      <td>£{{ t.recurring|floatformat:2|intcomma }}</td>
      <td>£{{ t.variable|floatformat:2|intcomma }}</td>
      <td>£{{ t.total|floatformat:2|intcomma }}</td>
      <td>£{{ t.balance|floatformat:2|intcomma }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="6" class="text-center">No data yet</td></tr>
  {% endfor %}
  </tbody>
</table>

<div class="row">
    <div class="col-md-6">
        <h3>Top Spending Items (Variable)</h3>
        <ul class="list-group">
        {% for item in top_variable %}
            <li class="list-group-item d-flex justify-content-between">
                {{ item.name }}
                <strong>£{{ item.total|floatformat:2|intcomma }}</strong>
            </li>
        {% empty %}
            <li class="list-group-item">No data yet</li>
        {% endfor %}
        </ul>
    </div>
    <div class="col-md-6">
        <h3>Category Breakdown ({{ latest_month }})</h3>
        <table class="table table-sm">
            <thead>
                <tr><th>Category</th><th>Rec.</th><th>Var.</th><th>Total</th></tr>
            </thead>
            <tbody>
            {% for c in category_breakdown %}
                <tr>
                    <td>{{ c.name }}</td>
                    <td>£{{ c.recurring|floatformat:2|intcomma }}</td>
                    <td>£{{ c.variable|floatformat:2|intcomma }}</td>
                    <td>£{{ c.total|floatformat:2|intcomma }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<h3>Forecast (next {{ forecast|length }} months)</h3>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Month</th><th>Recurring</th><th>Variable Est.</th><th>Total</th><th>Est. Balance</th>
    </tr>
  </thead>
  <tbody>
  {% for f in forecast %}
    <tr>
      <td>{{ f.month|date:'Y-m' }}</td>
      <td>£{{ f.recurring_total|floatformat:2|intcomma }}</td>
      <td>£{{ f.variable_estimate|floatformat:2|intcomma }}</td>
      <td>£{{ f.total_expenses|floatformat:2|intcomma }}</td>
      <td>£{{ f.balance|floatformat:2|intcomma }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="5" class="text-center">No forecast available</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
